<!DOCTYPE html>
<html prefix="
og: http://ogp.me/ns# article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="A friendly autopsy of a Tetris port made with Textual">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>textual-tetris, a Tetris in the terminal | tin_nqn</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/baguettebox.js/1.11.1/baguetteBox.min.css" integrity="sha256-cLMYWYYutHkt+KpNqjg7NVkYSQ+E2VbrXsEvOqU7mL0=" crossorigin="anonymous">
<link href="../../../assets/css/all.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS (en)" hreflang="en" href="../../rss.xml">
<link rel="alternate" type="application/rss+xml" title="RSS (es)" hreflang="es" href="../../../rss.xml">
<link rel="canonical" href="https://mgaitan.github.io/en/posts/textual-tetris/">
<!--[if lt IE 9]><script src="https://html5shim.googlecode.com/svn/trunk/html5.js"></script><![endif]--><meta name="author" content="Mart√≠n Gait√°n">
<link rel="prev" href="../easter-eggs-with-invisible-text/" title="Easter eggs in your code with invisible text" type="text/html">
<link rel="next" href="../whisperx-tutorial/" title="How to use WhisperX in Google Colab (2025)" type="text/html">
<meta property="og:site_name" content="tin_nqn">
<meta property="og:title" content="textual-tetris, a Tetris in the terminal">
<meta property="og:url" content="https://mgaitan.github.io/en/posts/textual-tetris/">
<meta property="og:description" content="A friendly autopsy of a Tetris port made with Textual">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2025-11-24T22:38:00-03:00">
<meta property="article:tag" content="games">
<meta property="article:tag" content="python">
<meta property="article:tag" content="terminal">
<meta property="article:tag" content="textual">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator:id" content="40654511">
<link rel="alternate" hreflang="es" href="../../../posts/textual-tetris/">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-expand-md static-top mb-4
navbar-light bg-light
"><div class="container">
<!-- This keeps the margins nice -->
        <a class="logo" href="../../">

            <div id="blog-title">
                    tin_nqn
                    <span id="blog-description">&gt;&gt;&gt; me.geek.post()</span>
            </div>
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="bs-navbar">
            <ul class="navbar-nav mr-auto">
<li class="nav-item">
<a href="../../about" class="nav-link">About me</a>
                </li>
<li class="nav-item">
<a href="../../archive.html" class="nav-link">Archive</a>
                </li>
<li class="nav-item">
<a href="../../categories/index.html" class="nav-link">Tags</a>
                </li>
<li class="nav-item">
<a href="../../rss.xml" class="nav-link">RSS feed</a>

                
            </li>
</ul>
<ul class="navbar-nav navbar-right">
<li class="nav-item">
                    <button class="nav-link theme-toggle" id="theme-toggle" type="button" aria-pressed="false" aria-label="Theme: Auto (system). Click to switch to light." title="Theme: Auto (system). Click to switch to light." data-mode="auto">
                        <svg class="theme-icon theme-icon-auto" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" aria-hidden="true"><path d="M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10-4.477 10-10 10zm0-2V4a8 8 0 1 0 0 16z"></path></svg><svg class="theme-icon theme-icon-light" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" aria-hidden="true"><path d="M12 18a6 6 0 1 1 0-12 6 6 0 0 1 0 12zm0-2a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636 5.636 7.05 3.515 4.93zM16.95 18.364l1.414-1.414 2.121 2.121-1.414 1.414-2.121-2.121zm2.121-14.85l1.414 1.415-2.121 2.121-1.414-1.414 2.121-2.121zM5.636 16.95l1.414 1.414-2.121 2.121-1.414-1.414 2.121-2.121zM23 11v2h-3v-2h3zM4 11v2H1v-2h3z"></path></svg><svg class="theme-icon theme-icon-dark" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" aria-hidden="true"><path d="M10 7a7 7 0 0 0 12 4.9v.1c0 5.523-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2h.1A6.979 6.979 0 0 0 10 7zm-6 5a8 8 0 0 0 15.062 3.762A9 9 0 0 1 8.238 4.938 7.999 7.999 0 0 0 4 12z"></path></svg></button>
                </li>
                    <li>            </li>
<li class="nav-item"><a href="../../../" rel="alternate" hreflang="es" class="nav-link">Espa√±ol</a></li>

                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">textual-tetris, a Tetris in the terminal</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    Mart√≠n Gait√°n
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2025-11-24T22:38:00-03:00" itemprop="datePublished" title="2025-11-24 22:38">2025-11-24 22:38</time></a>
            </p>
                <p class="commentline">        <a href="#disqus_thread" data-disqus-identifier="cache/posts/textual-tetris.html">Comments</a>


            
        </p>
</div>
                <div class="metadata posttranslations translations">
            <h3 class="posttranslations-intro">Also available in:</h3>
                <p><a href="../../../posts/textual-tetris/" rel="alternate" hreflang="es">Espa√±ol</a></p>
        </div>

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>Since I <a href="https://x.com/tin_nqn_/status/1978823177837912528">remain unemployed</a> while prioritizing my search for mental health, I spend my nerdy time on two worthwhile tasks:</p>
<ol>
<li>Collaborating with organizations that need technological solutions but do not have the budget to compete in the market for my skills.</li>
<li>The one relevant to this post: learning new things by implementing old ideas from the permanent <code>TO DO</code> list I <a href="https://github.com/mgaitan/mgaitan/issues">keep here</a>, the ones I almost never found time for.</li>
</ol>
<p>This time I wanted to learn a bit about <a href="https://textual.textualize.io/">Textual</a> (the elder sibling of <a href="https://rich.readthedocs.io/en/stable/">rich</a>), an excellent Python framework for building <a href="https://en.wikipedia.org/wiki/Text-based_user_interface">text-based users interfaces</a>.</p>
<p>And while I was at it, I learned how to make a Tetris clone that is pretty decent to play, does not look <em>that</em> ugly, and <a href="https://github.com/mgaitan/textual-tetris/blob/392744f6275160e5b8512e7f9f76b3a2e388fb4a/textris.py">currently sits at under 600 lines of Python code</a>, comments included. It looks like this:</p>
<p><img alt="" src="../../../images/textual-tetris.png"></p>
<p>But a taste is worth more than a thousand screenshots: open a terminal and, if you have <a href="https://docs.astral.sh/uv/">uv</a> installed (you should!), run:</p>
<div class="code"><pre class="code literal-block"><span class="go">uvx textual-tetris</span>
</pre></div>

<p>And you are already playing Tetris!</p>
<!-- TEASER_END -->

<h3>A walk through my implementation</h3>
<p>Tetris is not just any game. It is a pop culture icon, a product with geopolitical weight (do not miss <a href="https://cenital.com/la-invencion-del-tetris/">this article by Tom√°s Aguerre</a> on the topic --in spanish--), and an obsessive passion for the people who play it and program it.</p>
<p>There are <a href="https://github.com/search?q=tetris&amp;type=repositories">thousands of versions</a> in dozens of programming languages. From a <a href="https://en.wikipedia.org/wiki/Code_golf">code golf</a> version in JavaScript that <a href="https://blog.jay.vg/golf/tetris.html">fits in only 351 bytes</a>, one <a href="https://github.com/programble/tetrasm">in assembly that boots as an operating system</a>, and even one implemented <a href="https://th0mas.nl/2025/01/12/tetris-in-a-pdf/">inside a PDF file!</a>.</p>
<p>Mine is much more classic, but it has a few implementation details I want to point out.</p>
<p>For example, I borrowed <a href="https://github.com/olemb/tetris/">Ole Martin Bj√∏rndalen's idea</a> of encoding tetrominoes in all their possible orientations as a set of hexadecimal coordinates inside a 4x4 grid.</p>
<p>I recorded a short video to explain it:</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/6b1sauBX35g" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

<p>In the code it looks like this:</p>
<div class="code"><pre class="code literal-block"><span class="n">PIECES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"O"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"color"</span><span class="p">:</span> <span class="s2">"yellow"</span><span class="p">,</span> <span class="s2">"codes"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"56a9"</span><span class="p">,</span> <span class="s2">"6a95"</span><span class="p">,</span> <span class="s2">"a956"</span><span class="p">,</span> <span class="s2">"956a"</span><span class="p">]},</span>
    <span class="s2">"I"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"color"</span><span class="p">:</span> <span class="s2">"cyan"</span><span class="p">,</span> <span class="s2">"codes"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"4567"</span><span class="p">,</span> <span class="s2">"26ae"</span><span class="p">,</span> <span class="s2">"ba98"</span><span class="p">,</span> <span class="s2">"d951"</span><span class="p">]},</span>
    <span class="c1"># ...</span>
<span class="p">}</span>

<span class="k">class</span><span class="w"> </span><span class="nc">TetrisPiece</span><span class="p">:</span>
    <span class="o">...</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">(</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]):</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">char</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
            <span class="n">y</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
            <span class="n">coords</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">coords</span>
</pre></div>

<p>That property gives us the relative coordinates of the piece for the rotation described by <code>self.code</code>. Later we add those to the piece's <code>x, y</code> position relative to the board to compute the absolute position of the cells to draw. If these coordinates fit within the board dimensions, the cell changes from showing two blank spaces to two "‚ñà" characters (the full <a href="https://en.wikipedia.org/wiki/Block_Elements">block char</a>) with the piece color.</p>
<div class="code"><pre class="code literal-block">      <span class="k">for</span> <span class="n">board_x</span><span class="p">,</span> <span class="n">board_y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_piece</span><span class="o">.</span><span class="n">blocks</span><span class="p">:</span>
          <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">board_x</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_width</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">board_y</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_height</span><span class="p">:</span>
              <span class="n">display_board</span><span class="p">[</span><span class="n">board_y</span><span class="p">][</span><span class="n">board_x</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_piece</span><span class="o">.</span><span class="n">color</span>

      <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">display_board</span><span class="p">:</span>
          <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">row</span><span class="p">:</span>
              <span class="k">if</span> <span class="n">cell</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                  <span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"  "</span><span class="p">)</span>
              <span class="k">else</span><span class="p">:</span>
                  <span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"‚ñà‚ñà"</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="sa">f</span><span class="s2">"bold </span><span class="si">{</span><span class="n">cell</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>

<p>Rotating a piece basically means swapping the current code for the next one and looping back to the beginning once you run out (what is known as a round-robin).</p>
<p>Originally I kept track of a rotation index computed with modulo arithmetic.</p>
<div class="code"><pre class="code literal-block">    <span class="bp">self</span><span class="o">.</span><span class="n">rotation</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rotation</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">codes</span><span class="p">)</span>
</pre></div>

<p>Later I changed (simplified?) it to use <code>collections.deque</code>, which already has rotation methods.</p>
<div class="code"><pre class="code literal-block"><span class="k">class</span><span class="w"> </span><span class="nc">TetrisPiece</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">piece_type</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="o">...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">codes</span> <span class="o">=</span> <span class="n">deque</span><span class="p">(</span><span class="n">PIECES</span><span class="p">[</span><span class="n">piece_type</span><span class="p">][</span><span class="s2">"codes"</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">code</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">codes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">rotate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">codes</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">undo_rotate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">codes</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

<p><code>undo_rotate</code> is needed because when the board receives the command to rotate the current piece, it checks for collisions before rendering, and if there is one, the rotation must be reverted. For the player, this is the same as "you cannot rotate here":</p>
<div class="code"><pre class="code literal-block"><span class="k">def</span><span class="w"> </span><span class="nf">rotate_piece</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Rotate the current piece"""</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">current_piece</span><span class="o">.</span><span class="n">rotate</span><span class="p">()</span>

    <span class="c1"># Check if rotation causes collision</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_collision</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_piece</span><span class="o">.</span><span class="n">undo_rotate</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">update_display</span><span class="p">()</span>
    <span class="k">return</span> <span class="kc">True</span>
</pre></div>

<p>The same try/revert-on-collision criteria applies to movement. Here is <code>move_piece</code>:</p>
<div class="code"><pre class="code literal-block"><span class="k">def</span><span class="w"> </span><span class="nf">move_piece</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">):</span>
    <span class="n">old_x</span><span class="p">,</span> <span class="n">old_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_piece</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_piece</span><span class="o">.</span><span class="n">y</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">current_piece</span><span class="o">.</span><span class="n">x</span> <span class="o">+=</span> <span class="n">dx</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">current_piece</span><span class="o">.</span><span class="n">y</span> <span class="o">+=</span> <span class="n">dy</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_collision</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_piece</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_piece</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">old_x</span><span class="p">,</span> <span class="n">old_y</span>
        <span class="k">if</span> <span class="n">dy</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lock_piece</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">update_display</span><span class="p">()</span>
    <span class="k">return</span> <span class="kc">True</span>
</pre></div>

<p>But what counts as a collision? Discrete geometry:</p>
<div class="code"><pre class="code literal-block"><span class="k">def</span><span class="w"> </span><span class="nf">check_collision</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">board_x</span><span class="p">,</span> <span class="n">board_y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_piece</span><span class="o">.</span><span class="n">blocks</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">board_x</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">board_x</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_width</span> <span class="ow">or</span> <span class="n">board_y</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">board_height</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">board_y</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">board</span><span class="p">[</span><span class="n">board_y</span><span class="p">][</span><span class="n">board_x</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>
</pre></div>

<p>When moving down (<code>dy &gt; 0</code>), if we hit something, <code>lock_piece</code> is called: it locks the colors into the grid, clears full lines, and notifies the <code>App</code>. That answers the classic "why can't I keep going down?" Because the function tried the move and it collided with a wall or an already locked block.</p>
<h3>Widgets, bindings, and Textual magic</h3>
<p>A Textual app is made up of <a href="https://textual.textualize.io/widget_gallery/">widgets</a> (buttons, inputs, options, etc.) that can be grouped into <code>Container</code> instances. Every widget and container can be associated with a (pseudo) CSS style.</p>
<p>The composition for this Tetris is pretty self-explanatory:</p>
<div class="code"><pre class="code literal-block">    <span class="k">def</span><span class="w"> </span><span class="nf">compose</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ComposeResult</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">Container</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">"game-container"</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">Label</span><span class="p">(</span><span class="s2">"üéÆ TETRIS üïπ"</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="s2">"title"</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">Horizontal</span><span class="p">():</span>
                <span class="k">with</span> <span class="n">Container</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">"board-container"</span><span class="p">):</span>
                    <span class="k">yield</span> <span class="n">TetrisBoard</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">"board"</span><span class="p">)</span>
                    <span class="k">yield</span> <span class="n">Static</span><span class="p">(</span><span class="s2">"GAME OVER</span><span class="se">\n</span><span class="s2">Press R to restart"</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="s2">"game-over-overlay"</span><span class="p">)</span>
                <span class="k">with</span> <span class="n">Vertical</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">"sidebar"</span><span class="p">):</span>
                    <span class="k">with</span> <span class="n">Container</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">"next-piece-container"</span><span class="p">):</span>
                        <span class="k">yield</span> <span class="n">NextPieceWidget</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">"next-piece"</span><span class="p">)</span>
                    <span class="k">with</span> <span class="n">Container</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">"score-container"</span><span class="p">):</span>
                        <span class="k">yield</span> <span class="n">ScoreWidget</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">"score-widget"</span><span class="p">)</span>
                    <span class="k">with</span> <span class="n">Container</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">"controls"</span><span class="p">):</span>
                        <span class="k">yield</span> <span class="n">Label</span><span class="p">(</span><span class="s2">"CONTROLS"</span><span class="p">,</span> <span class="n">classes</span><span class="o">=</span><span class="s2">"section-title"</span><span class="p">)</span>
                        <span class="k">yield</span> <span class="n">Label</span><span class="p">(</span><span class="s2">"‚Üë/W: Rotate"</span><span class="p">)</span>
                        <span class="k">yield</span> <span class="n">Label</span><span class="p">(</span><span class="s2">"‚Üê/A: Move Left"</span><span class="p">)</span>
                        <span class="k">yield</span> <span class="n">Label</span><span class="p">(</span><span class="s2">"‚Üí/D: Move Right"</span><span class="p">)</span>
                        <span class="k">yield</span> <span class="n">Label</span><span class="p">(</span><span class="s2">"‚Üì/S: Move Down"</span><span class="p">)</span>
                        <span class="k">yield</span> <span class="n">Label</span><span class="p">(</span><span class="s2">"Space: Drop"</span><span class="p">)</span>
                        <span class="k">yield</span> <span class="n">Label</span><span class="p">(</span><span class="s2">"Ctrl+Q: Quit"</span><span class="p">)</span>
</pre></div>

<p>All the custom widgets I defined‚Äî<code>TetrisBoard</code>, <code>NextPieceWidget</code>, and <code>ScoreWidget</code>‚Äîinherit from <code>Static</code>, the most basic, non-reactive widget, but one that can obviously be re-rendered as many times as needed to update its contents.</p>
<p>Those updates get triggered by various events, in this case keyboard input and a timer that handles automatic falling (Textual also supports mouse events). The bridge between events and logic lives in <code>TetrisApp.BINDINGS</code>:</p>
<div class="code"><pre class="code literal-block"><span class="n">BINDINGS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="s2">"left,a"</span><span class="p">,</span> <span class="s2">"move_left"</span><span class="p">,</span> <span class="s2">"Move Left"</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">"right,d"</span><span class="p">,</span> <span class="s2">"move_right"</span><span class="p">,</span> <span class="s2">"Move Right"</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">"down,s"</span><span class="p">,</span> <span class="s2">"move_down"</span><span class="p">,</span> <span class="s2">"Move Down"</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">"up,w"</span><span class="p">,</span> <span class="s2">"rotate"</span><span class="p">,</span> <span class="s2">"Rotate"</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">"space"</span><span class="p">,</span> <span class="s2">"hard_drop"</span><span class="p">,</span> <span class="s2">"Drop"</span><span class="p">),</span>
    <span class="o">...</span>
<span class="p">)</span>
</pre></div>

<p>Each binding maps key combinations to <code>action_*</code> methods. When Textual detects the key event, it calls <code>action_move_left</code>, <code>action_hard_drop</code>, etc. An excellent developer-facing API if you ask me!</p>
<p>And there is a neat trick: when you lose, beyond showing the "Game over" overlay (which actually always exists but stays hidden), the method in charge also <a href="https://textual.textualize.io/guide/actions/#dynamic-actions">disables several bindings dynamically</a>, so you cannot move anymore. Unplugging events from actions like this keeps the methods clean, without littering them with checks such as <code>if not self.game_over: ...</code>.</p>
<p>By the way, Textual's documentation is incredibly good. I recommend reading it even if you do not yet have a project in mind.</p>
<h3>Rack up the points!</h3>
<p>When a piece can no longer fall (because a manual or automatic downward movement collides), the <code>on_piece_locked</code> method gets called.</p>
<div class="code"><pre class="code literal-block">    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_collision</span><span class="p">():</span>
        <span class="c1"># Revert move</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_piece</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_piece</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">old_x</span><span class="p">,</span> <span class="n">old_y</span>
        <span class="c1"># If we were moving down, lock the piece in place</span>
        <span class="k">if</span> <span class="n">dy</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lock_piece</span><span class="p">()</span>
</pre></div>

<p>This method adds points, checks whether you level up, and in turn increases the falling speed.</p>
<div class="code"><pre class="code literal-block"><span class="n">line_score</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span> <span class="mi">800</span><span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cleared_lines</span><span class="p">,</span> <span class="n">cleared_lines</span> <span class="o">*</span> <span class="mi">200</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">+=</span> <span class="n">line_score</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="k">if</span> <span class="n">cleared_lines</span> <span class="k">else</span> <span class="mi">10</span>
<span class="bp">self</span><span class="o">.</span><span class="n">lines_cleared</span> <span class="o">+=</span> <span class="n">cleared_lines</span>
<span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines_cleared</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines_per_level</span><span class="p">)</span>
</pre></div>

<p>The duration of the pause between every automatic drop step (a.k.a. the "gravity" speed) is an inverse exponential function of the level.</p>
<!--$$
t_{\text{drop}}(L) = \max\!\Bigl(0.02,\;\bigl(0.8 - 0.007(L-1)\bigr)^{\,L-1}\Bigr)
$$-->

<p><img alt="" src="https://quicklatex.com/cache3/71/ql_357031cd1c3bcd37e352da356333a171_l3.png"></p>
<p>Plotted, it looks like this:</p>
<p><img alt="velocidad" src="../../../images/drop_interval_levels_xkcd.png"></p>
<p>Where did I get that outlandish formula? From the <a href="https://archive.org/details/2009-tetris-variant-concepts_202201/2009%20Tetris%20Design%20Guideline/page/20/mode/2up">official Tetris design guideline</a>, of course.</p>
<p>If you want every recommendation from that guideline for your own Tetris clone, there is a <a href="https://pypi.org/project/tetris/">Python library that implements it seriously</a>.</p>
<h3>What's still pending?</h3>
<p>The UI is kind of mediocre, let's be honest. Textual is amazing, but arranging things on screen still requires knowing some CSS, and we Python folks are not famous for that. LLMs <a href="https://x.com/ralsina/status/1991205490781573430">do not help much either</a>.</p>
<div class="tenor-gif-embed" data-postid="12014506" data-share-method="host" data-aspect-ratio="1.33333" data-width="60%">
<a href="https://tenor.com/view/family-guy-css-open-window-annoyed-pissed-gif-12014506">Family Guy Css GIF</a>from <a href="https://tenor.com/search/family+guy-gifs">Family Guy GIFs</a>
</div>
<script type="text/javascript" async src="https://tenor.com/embed.js"></script><p>The code could probably be tidied up too. For example, there is some duplicated logic between the board rendering and the next-piece widget.</p>
<p>Restarting a game is a bit crude (it spawns a new process!). There is no pause action. And above all, it still lacks the support for two (or more!) players at the same time ‚Äîthe strongest request from my most skilled user, my 10-year-old daughter Ema.</p>
<p>I would love to hear your comments, suggestions, and pull requests!</p>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/games/" rel="tag">games</a></li>
            <li><a class="tag p-category" href="../../categories/python/" rel="tag">python</a></li>
            <li><a class="tag p-category" href="../../categories/terminal/" rel="tag">terminal</a></li>
            <li><a class="tag p-category" href="../../categories/textual/" rel="tag">textual</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../easter-eggs-with-invisible-text/" rel="prev" title="Easter eggs in your code with invisible text">Previous post</a>
            </li>
            <li class="next">
                <a href="../whisperx-tutorial/" rel="next" title="How to use WhisperX in Google Colab (2025)">Next post</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
                    <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="nqnwebs",
            disqus_url="https://mgaitan.github.io/en/posts/textual-tetris/",
        disqus_title="textual-tetris, a Tetris in the terminal",
        disqus_identifier="cache/posts/textual-tetris.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section></article><script>var disqus_shortname="nqnwebs";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script><!--End of body content--><footer id="footer">
            Contents ¬© 2025         <a href="mailto:gaitan@gmail.com">Mart√≠n Gait√°n</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            
        </footer>
</div>
</div>

        <script src="https://code.jquery.com/jquery-3.6.4.min.js" integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js" integrity="sha384-+sLIOodYLS7CIrQpBjl+C7nPvqq+FbNUBDunl/OZv93DB7Ln/533i8e/mZXLi/P+" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/baguettebox.js/1.11.1/baguetteBox.min.js" integrity="sha256-ULQV01VS9LCI2ePpLsmka+W0mawFpEA0rtxnezUj4A4=" crossorigin="anonymous"></script><script src="../../../assets/js/all.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script>
    (function() {
        var storageKey = 'theme-mode';
        var toggle = document.getElementById('theme-toggle');
        if (!toggle) return;
        var prefersDark = window.matchMedia ? window.matchMedia('(prefers-color-scheme: dark)') : null;
        var modes = ['auto', 'light', 'dark'];

        function savedMode() {
            var stored = localStorage.getItem(storageKey);
            if (modes.indexOf(stored) !== -1) {
                return stored;
            }
            return 'auto';
        }

        function resolvedTheme(mode) {
            if (mode === 'light' || mode === 'dark') return mode;
            return prefersDark && prefersDark.matches ? 'dark' : 'light';
        }

        function labels(mode, resolved) {
            if (mode === 'auto') {
                return {
                    aria: "Theme: Auto (system). Click to switch to light.",
                    next: 'light'
                };
            }
            if (mode === 'light') {
                return {
                    aria: "Theme: Light. Click to switch to dark.",
                    next: 'dark'
                };
            }
            return {
                aria: "Theme: Dark. Click to switch to auto.",
                next: 'auto'
            };
        }

        function apply(mode) {
            var resolved = resolvedTheme(mode);
            document.body.setAttribute('data-theme', resolved);
            document.body.setAttribute('data-theme-mode', mode);
            toggle.dataset.mode = mode;
            var label = labels(mode, resolved);
            toggle.setAttribute('aria-pressed', resolved === 'dark');
            toggle.setAttribute('aria-label', label.aria);
            toggle.setAttribute('title', label.aria);
        }

        function setMode(mode) {
            localStorage.setItem(storageKey, mode);
            apply(mode);
        }

        apply(savedMode());

        toggle.addEventListener('click', function() {
            var current = document.body.getAttribute('data-theme-mode') || savedMode();
            var next = labels(current).next;
            setMode(next);
        });

        if (prefersDark && prefersDark.addEventListener) {
            prefersDark.addEventListener('change', function() {
                if (savedMode() === 'auto') {
                    apply('auto');
                }
            });
        }
    })();
    </script><script src="../../../assets/js/jquery.timeago.js" type="text/javascript"></script><script>
    jQuery(document).ready(function() {

        if(jQuery('html').attr('lang') === 'es'){
             jQuery.timeago.settings.strings = {
               prefixAgo: "hace",
               prefixFromNow: "dentro de",
               suffixAgo: "",
               suffixFromNow: "",
               seconds: "menos de un minuto",
               minute: "un minuto",
               minutes: "unos %d minutos",
               hour: "una hora",
               hours: "%d horas",
               day: "un d√≠a",
               days: "%d d√≠as",
               month: "un mes",
               months: "%d meses",
               year: "un a√±o",
               years: "%d a√±os"
            };
        }
        jQuery("time.published").timeago();

        jQuery('article:not(:first)').before('<hr>');

        jQuery('.highlight pre').addClass('code');
    });
    </script><script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-51074482-1', 'mgaitan.github.io');
      ga('send', 'pageview');

    </script>
</body>
</html>
