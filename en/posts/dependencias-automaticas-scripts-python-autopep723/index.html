<!DOCTYPE html>
<html prefix="
og: http://ogp.me/ns# article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Automatic dependencies management for Python scripts with autopep723 | tin_nqn</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/baguettebox.js/1.11.1/baguetteBox.min.css" integrity="sha256-cLMYWYYutHkt+KpNqjg7NVkYSQ+E2VbrXsEvOqU7mL0=" crossorigin="anonymous">
<link href="../../../assets/css/all.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS (en)" hreflang="en" href="../../rss.xml">
<link rel="alternate" type="application/rss+xml" title="RSS (es)" hreflang="es" href="../../../rss.xml">
<link rel="canonical" href="https://mgaitan.github.io/en/posts/dependencias-automaticas-scripts-python-autopep723/">
<!--[if lt IE 9]><script src="https://html5shim.googlecode.com/svn/trunk/html5.js"></script><![endif]--><meta name="author" content="Martín Gaitán">
<link rel="prev" href="../animated-svgs-for-your-cli-program-demos/" title="Animated SVGs for your CLI program demos" type="text/html">
<meta property="og:site_name" content="tin_nqn">
<meta property="og:title" content="Automatic dependencies management for Python scripts with autopep723">
<meta property="og:url" content="https://mgaitan.github.io/en/posts/dependencias-automaticas-scripts-python-autopep723/">
<meta property="og:description" content="Have you ever wished you could run a Python script without worrying about installing its dependencies first?
We've all been there. You need to hack a small piece of code, maybe your LLM friend gives y">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2025-07-25T08:00:00-03:00">
<meta property="article:tag" content="automation">
<meta property="article:tag" content="dependencies">
<meta property="article:tag" content="pep723">
<meta property="article:tag" content="python">
<meta property="article:tag" content="uv">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator:id" content="40654511">
<link rel="alternate" hreflang="es" href="../../../posts/dependencias-automaticas-scripts-python-autopep723/">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-expand-md static-top mb-4
navbar-light bg-light
"><div class="container">
<!-- This keeps the margins nice -->
        <a class="logo" href="../../">

            <div id="blog-title">
                    tin_nqn
                    <span id="blog-description">&gt;&gt;&gt; me.geek.post()</span>
            </div>
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="bs-navbar">
            <ul class="navbar-nav mr-auto">
<li class="nav-item">
<a href="../../about" class="nav-link">About me</a>
                </li>
<li class="nav-item">
<a href="../../archive.html" class="nav-link">Archive</a>
                </li>
<li class="nav-item">
<a href="../../categories/index.html" class="nav-link">Tags</a>
                </li>
<li class="nav-item">
<a href="../../rss.xml" class="nav-link">RSS feed</a>

                
            </li>
</ul>
<ul class="navbar-nav navbar-right">
<li>            </li>
<li class="nav-item"><a href="../../../" rel="alternate" hreflang="es" class="nav-link">Español</a></li>

        <li class="nav-item">
    <a href="index.md" id="sourcelink" class="nav-link">The source of this post is available in </a>
    </li>

                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Automatic dependencies management for Python scripts with autopep723</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    Martín Gaitán
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2025-07-25T08:00:00-03:00" itemprop="datePublished" title="2025-07-25 08:00">2025-07-25 08:00</time></a>
            </p>
                <p class="commentline">        <a href="#disqus_thread" data-disqus-identifier="cache/posts/autopep723-shebang-magic.html">Comments</a>


                    </p>
<p class="sourceline"><a href="index.md" class="sourcelink">The source of this post is available in </a></p>

        </div>
                <div class="metadata posttranslations translations">
            <h3 class="posttranslations-intro">Also available in:</h3>
                <p><a href="../../../posts/dependencias-automaticas-scripts-python-autopep723/" rel="alternate" hreflang="es">Español</a></p>
        </div>

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>Have you ever wished you could run a Python script without worrying about installing its dependencies first?</p>
<p>We've all been there. You need to hack a small piece of code, maybe your LLM friend gives you a useful Python script you want to try, or you found something on Stack Overflow (God rest its soul) or gist. But if you try to run it directly:</p>
<div class="code"><pre class="code literal-block"><span class="ne">ModuleNotFoundError</span><span class="p">:</span> <span class="n">No</span> <span class="n">module</span> <span class="n">named</span> <span class="s1">'your_experiment_dependency'</span>
</pre></div>

<p>Then begins the bureaucracy of checking which packages you need, with the aggravating factor that many times the name with which it is installed does not correspond to the name that is imported, dealing with version conflicts and overloading your environment.</p>
<p>If everyone agrees that Python is a pragmatic and elegant language that's ideal for scripts, why does this part have to be complicated?</p>
<!-- TEASER_END -->

<p>Consider a data analysis script</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span><span class="w"> </span><span class="nn">httpx</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.cluster</span><span class="w"> </span><span class="kn">import</span> <span class="n">KMeans</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"https://api.github.com/users/octocat"</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()])</span>
<span class="c1"># ... analysis</span>
</pre></div>

<p>The old-school way (booh!) involves setting up a virtual environment, activating it, and manually installing each dependency:</p>
<div class="code"><pre class="code literal-block">python<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>venv
<span class="nb">source</span><span class="w"> </span>venv/bin/activate<span class="w">  </span><span class="c1"># or venv\Scripts\activate on Windows</span>
pip<span class="w"> </span>install<span class="w"> </span>httpx<span class="w"> </span>pandas<span class="w"> </span>matplotlib<span class="w"> </span>seaborn<span class="w"> </span>scikit-learn
python<span class="w"> </span>script.py
</pre></div>

<p>Of course, the situation has improved a lot since the appearance of the glorious <a href="https://docs.astral.sh/uv/">uv</a> with which you can run your script in an implicit virtualenv <a href="https://docs.astral.sh/uv/guides/scripts/#running-a-script-with-dependencies">with dependencies</a> in a single line:</p>
<div class="code"><pre class="code literal-block">uv<span class="w"> </span>run<span class="w"> </span>--with<span class="w"> </span>httpx<span class="w"> </span>--with<span class="w"> </span>pandas<span class="w"> </span>--with<span class="w"> </span>matplotlib<span class="w"> </span>--with<span class="w"> </span>seaborn<span class="w"> </span>--with<span class="w"> </span>scikit-learn<span class="w"> </span>script.py
</pre></div>

<p>However this does not scale for non trivial cases and every time you want to run your script you will have to remember all the packages you need. That is, the script is not self-contained.</p>
<p>A better step is to include a comment in the header of the script in the format of <a href="https://peps.python.org/pep-0723/">PEP 723</a> that <code>uv run</code> supports, so that the script itself declares its dependencies:</p>
<div class="code"><pre class="code literal-block"><span class="c1"># /// script</span>
<span class="c1"># requires-python = "&gt;=3.12"</span>
<span class="c1"># dependencies = [</span>
<span class="c1">#     "httpx",</span>
<span class="c1">#     "pandas",</span>
<span class="c1">#     "matplotlib",</span>
<span class="c1">#     "seaborn",</span>
<span class="c1">#     "scikit-learn",</span>
<span class="c1"># ]</span>
<span class="c1"># ///</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">httpx</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.cluster</span><span class="w"> </span><span class="kn">import</span> <span class="n">KMeans</span>
<span class="o">...</span>
</pre></div>

<p>But there is a more elegant solution: simply <strong>run your scripts using <a href="https://github.com/mgaitan/autopep723">autopep723</a></strong></p>
<div class="code"><pre class="code literal-block">uvx<span class="w"> </span>autopep723<span class="w"> </span>script.py
</pre></div>

<p>No <code>--with</code>, no specially crafted comments, just plain Python imports as if the whole PyPI package ecosystem were the standard library.</p>
<p>Since <code>uv run</code> can execute remote scripts (technically, downloading them to a temp directory before executing), <code>autopep723</code> can do the same, so let's try it with a real example</p>
<script src="https://gist.github.com/mgaitan/7052bbe00c2cc88f8771b576c36665ae.js"></script><div class="code"><pre class="code literal-block">uvx<span class="w"> </span>autopep723<span class="w"> </span>https://gist.githubusercontent.com/mgaitan/7052bbe00c2cc88f8771b576c36665ae/raw/cbaa289ef7712b5f4c5a55316cce4269f5645c20/autopep723_rocks.py
</pre></div>

<p><img width="1122" height="722" alt="autopep8" src="https://gist.github.com/user-attachments/assets/b1413418-4ce7-4b04-9452-d69de3af3d82"></p>
<p><strong>An extra tip?</strong> Use <code>autopep723</code> directly as the shebang of your script</p>
<div class="code"><pre class="code literal-block"><span class="ch">#!/usr/bin/env -S uvx autopep723</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">httpx</span>
<span class="o">...</span>
</pre></div>

<p>After marking the script as executable you can simply run <code>./script.py</code>. Dependencies are automatically detected and installed in an ephemeral environment. Share this script with anyone with <code>uv</code> installed and it will just work on their machine too!</p>
<h3>How it works</h3>
<p>Behind the scenes, <code>autopep723</code> parses your script using AST to detect third-party imports, handles complicated cases where import names differ from package names (e.g., <code>import PIL</code> → <code>pillow</code>), then runs your script using <code>uv run</code> passing the necessary <code>--with</code> automatically. Everything happens in a clean, ephemeral environment thanks to <code>uvx</code>'s isolation capabilities.</p>
<p>In my humble opinion, this approach solves several pain points that plague Python script distribution. Scripts simply work immediately with zero setup friction, while <code>uvx</code> ensures no environment pollution as dependencies are installed in isolation. Each script gets its own clean environment, avoiding version conflicts, making scripts truly portable with no installation instructions. <code>uv</code>'s speed makes this practical for daily use rather than just a clever demo.</p>
<p>By the way, you can also use <code>autopep723</code> to add PEP 723 metadata to existing scripts:</p>
<div class="code"><pre class="code literal-block">autopep723<span class="w"> </span>add<span class="w"> </span>script.py<span class="w">  </span><span class="c1"># Adds PEP 723 to the file</span>
</pre></div>

<p>and then simply use <code>uv run script.py</code></p>
<h3>The future</h3>
<p>To be honest, I wish this package didn't exist, but was a built-in feature of uv.</p>
<p>I tweeted about this idea asking for a <code>--with-auto</code> flag that does its best attempt to satisfy missing dependencies:</p>
<blockquote class="twitter-tweet">
<p lang="en" dir="ltr">how about a --with-auto that does its best attempt to satisfy missing deps? <a href="https://t.co/yYvYXGKZnM">https://t.co/yYvYXGKZnM</a></p>— Martín Gaitán (@tin_nqn_) <a href="https://twitter.com/tin_nqn_/status/1825970796478738940?ref_src=twsrc%5Etfw">August 21, 2024</a>
</blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script><p>Here is my <a href="https://github.com/astral-sh/uv/issues/6283">open proposal</a>. Until then, <code>autopep723</code> closes the gap, making Python scripts as easy to run as shell scripts.</p>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/automation/" rel="tag">automation</a></li>
            <li><a class="tag p-category" href="../../categories/dependencies/" rel="tag">dependencies</a></li>
            <li><a class="tag p-category" href="../../categories/pep723/" rel="tag">pep723</a></li>
            <li><a class="tag p-category" href="../../categories/python/" rel="tag">python</a></li>
            <li><a class="tag p-category" href="../../categories/uv/" rel="tag">uv</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../animated-svgs-for-your-cli-program-demos/" rel="prev" title="Animated SVGs for your CLI program demos">Previous post</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
                    <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="nqnwebs",
            disqus_url="https://mgaitan.github.io/en/posts/dependencias-automaticas-scripts-python-autopep723/",
        disqus_title="Automatic dependencies management for Python scripts with autopep723",
        disqus_identifier="cache/posts/autopep723-shebang-magic.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section></article><script>var disqus_shortname="nqnwebs";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script><!--End of body content--><footer id="footer">
            Contents © 2025         <a href="mailto:gaitan@gmail.com">Martín Gaitán</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            
        </footer>
</div>
</div>

        <script src="https://code.jquery.com/jquery-3.6.4.min.js" integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js" integrity="sha384-+sLIOodYLS7CIrQpBjl+C7nPvqq+FbNUBDunl/OZv93DB7Ln/533i8e/mZXLi/P+" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/baguettebox.js/1.11.1/baguetteBox.min.js" integrity="sha256-ULQV01VS9LCI2ePpLsmka+W0mawFpEA0rtxnezUj4A4=" crossorigin="anonymous"></script><script src="../../../assets/js/all.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="../../../assets/js/jquery.timeago.js" type="text/javascript"></script><script>
    jQuery(document).ready(function() {

        if(jQuery('html').attr('lang') === 'es'){
             jQuery.timeago.settings.strings = {
               prefixAgo: "hace",
               prefixFromNow: "dentro de",
               suffixAgo: "",
               suffixFromNow: "",
               seconds: "menos de un minuto",
               minute: "un minuto",
               minutes: "unos %d minutos",
               hour: "una hora",
               hours: "%d horas",
               day: "un día",
               days: "%d días",
               month: "un mes",
               months: "%d meses",
               year: "un año",
               years: "%d años"
            };
        }
        jQuery("time.published").timeago();

        jQuery('article:not(:first)').before('<hr>');

        jQuery('.highlight pre').addClass('code');
    });
    </script><script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-51074482-1', 'mgaitan.github.io');
      ga('send', 'pageview');

    </script>
</body>
</html>
