<!DOCTYPE html>
<html prefix="
og: http://ogp.me/ns# article: http://ogp.me/ns/article#
" lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Depedencias automáticas en scripts Python con autopep723 | tin_nqn</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/baguettebox.js/1.11.1/baguetteBox.min.css" integrity="sha256-cLMYWYYutHkt+KpNqjg7NVkYSQ+E2VbrXsEvOqU7mL0=" crossorigin="anonymous">
<link href="../../assets/css/all.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS (es)" hreflang="es" href="../../rss.xml">
<link rel="alternate" type="application/rss+xml" title="RSS (en)" hreflang="en" href="../../en/rss.xml">
<link rel="canonical" href="https://mgaitan.github.io/posts/dependencias-automaticas-scripts-python-autopep723/">
<!--[if lt IE 9]><script src="https://html5shim.googlecode.com/svn/trunk/html5.js"></script><![endif]--><meta name="author" content="Martín Gaitán">
<link rel="prev" href="../svg-animados-para-tus-demos-de-programas-cli/" title="SVG animados para tus demos de programas CLI" type="text/html">
<meta property="og:site_name" content="tin_nqn">
<meta property="og:title" content="Depedencias automáticas en scripts Python con autopep723">
<meta property="og:url" content="https://mgaitan.github.io/posts/dependencias-automaticas-scripts-python-autopep723/">
<meta property="og:description" content="¿Alguna vez has deseado poder ejecutar un script de Python sin preocuparte por instalar sus dependencias primero?
Todos hemos estado ahí. Necesitas hackear un pequeño fragmento de código, tu LLM amigo">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2025-07-25T08:00:00-03:00">
<meta property="article:tag" content="automation">
<meta property="article:tag" content="dependencies">
<meta property="article:tag" content="pep723">
<meta property="article:tag" content="python">
<meta property="article:tag" content="uv">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator:id" content="40654511">
<link rel="alternate" hreflang="en" href="../../en/posts/dependencias-automaticas-scripts-python-autopep723/">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Ir al contenido principal</a>

<!-- Menubar -->

<nav class="navbar navbar-expand-md static-top mb-4
navbar-light bg-light
"><div class="container">
<!-- This keeps the margins nice -->
        <a class="logo" href="../../">

            <div id="blog-title">
                    tin_nqn
                    <span id="blog-description">&gt;&gt;&gt; me.geek.post()</span>
            </div>
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="bs-navbar">
            <ul class="navbar-nav mr-auto">
<li class="nav-item">
<a href="../../about/" class="nav-link">Sobre mí</a>
                </li>
<li class="nav-item">
<a href="../../charlas/" class="nav-link">Charlas</a>
                </li>
<li class="nav-item">
<a href="../../archive.html" class="nav-link">Archivos</a>
                </li>
<li class="nav-item">
<a href="../../categories/index.html" class="nav-link">Categorías</a>
                </li>
<li class="nav-item">
<a href="../../rss.xml" class="nav-link">RSS</a>

                
            </li>
</ul>
<ul class="navbar-nav navbar-right">
<li>            </li>
<li class="nav-item"><a href="../../en/" rel="alternate" hreflang="en" class="nav-link">English</a></li>

                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Depedencias automáticas en scripts Python con autopep723</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    Martín Gaitán
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2025-07-25T08:00:00-03:00" itemprop="datePublished" title="2025-07-25 08:00">2025-07-25 08:00</time></a>
            </p>
                <p class="commentline">        <a href="#disqus_thread" data-disqus-identifier="cache/posts/autopep723-shebang-magic.html">Comentarios</a>


            
        </p>
</div>
                <div class="metadata posttranslations translations">
            <h3 class="posttranslations-intro">También disponible en:</h3>
                <p><a href="../../en/posts/dependencias-automaticas-scripts-python-autopep723/" rel="alternate" hreflang="en">English</a></p>
        </div>

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>¿Alguna vez has deseado poder ejecutar un script de Python sin preocuparte por instalar sus dependencias primero?</p>
<p>Todos hemos estado ahí. Necesitas hackear un pequeño fragmento de código, tu LLM amigo te da un script de Python útil o encontraste uno en Stack Overflow (Dios te tenga en la gloria) o Gist. Pero si lo intentas ejecutar directamente:</p>
<div class="code"><pre class="code literal-block"><span class="n">ModuleNotFoundError</span><span class="p">:</span><span class="w"> </span><span class="n">No</span><span class="w"> </span><span class="k">module</span><span class="w"> </span><span class="nn">named</span><span class="w"> </span><span class="c">'your_experiment_dependency'</span>
</pre></div>

<p>Entonces comienza la burocracia de verificar qué paquetes necesitas, con el agravante de que muchas veces el nombre con el que se instala no corresponde con el nombre que se importa), lidiar con conflictos de versiones y sobrecargar tu entorno.</p>
<p>Si todo el mundo coincide en que Python es un lenguaje pragmático y elegante que resulta ideal para scripts, ¿por qué esta parte tiene que ser complicada?</p>
<!-- TEASER_END -->

<p>Considera este script de análisis de datos</p>
<div class="code"><pre class="code literal-block"><span class="kn">import</span><span class="w"> </span><span class="nn">httpx</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.cluster</span><span class="w"> </span><span class="kn">import</span> <span class="n">KMeans</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">httpx</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"https://api.github.com/users/octocat"</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()])</span>
<span class="c1"># ... análisis</span>
</pre></div>

<p>La forma tradicional implica configurar un entorno virtual, activarlo e instalar manualmente cada dependencia:</p>
<div class="code"><pre class="code literal-block">python<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>venv
<span class="nb">source</span><span class="w"> </span>venv/bin/activate<span class="w">  </span><span class="c1"># o venv\Scripts\activate en Windows</span>
pip<span class="w"> </span>install<span class="w"> </span>httpx<span class="w"> </span>pandas<span class="w"> </span>matplotlib<span class="w"> </span>seaborn<span class="w"> </span>scikit-learn
python<span class="w"> </span>script.py
</pre></div>

<p>Por supuesto, la situación mejoró mucho desde la aparición del glorioso <a href="https://docs.astral.sh/uv/">uv</a> con el que podés ejecutar tu script en un virtualenv efímero en una sola línea</p>
<div class="code"><pre class="code literal-block">uv<span class="w"> </span>run<span class="w"> </span>--with<span class="w"> </span>httpx<span class="w"> </span>--with<span class="w"> </span>pandas<span class="w"> </span>--with<span class="w"> </span>matplotlib<span class="w"> </span>--with<span class="w"> </span>seaborn<span class="w"> </span>--with<span class="w"> </span>scikit-learn<span class="w"> </span>script.py
</pre></div>

<p>Pero claramente esto no escala y cada vez que quieras ejecutar tu script tendrás que recordar todos los paquetes que necesitas. Es decir, el script no es autocontenido.</p>
<p>Un paso mejor es incluir un comentario de metadata en la cabecera del script en el formato de <a href="https://peps.python.org/pep-0723/">PEP 723</a> que <code>uv run</code> soporta,
de modo que el propio script declare sus dependencias y sea "autocontenido".</p>
<div class="code"><pre class="code literal-block"><span class="c1"># /// script</span>
<span class="c1"># requires-python = "&gt;=3.12"</span>
<span class="c1"># dependencies = [</span>
<span class="c1">#     "httpx",</span>
<span class="c1">#     "pandas",</span>
<span class="c1">#     "matplotlib",</span>
<span class="c1">#     "seaborn",</span>
<span class="c1">#     "scikit-learn",</span>
<span class="c1"># ]</span>
<span class="c1"># ///</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">httpx</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.cluster</span><span class="w"> </span><span class="kn">import</span> <span class="n">KMeans</span>
</pre></div>

<p>Pero hay una solución más elegante: <strong>ejecuta tus scripts usando autopep723</strong></p>
<div class="code"><pre class="code literal-block">uvx<span class="w"> </span>autopep723<span class="w"> </span>script.py
</pre></div>

<p>Como <code>uv run</code> puede ejecutar scripts remotos (tecnicamente, bajarlos antes de ejecutarlos), también lo puede hacer
<code>autopep723</code>, así que probemos con un ejemplo real</p>
<script src="https://gist.github.com/mgaitan/7052bbe00c2cc88f8771b576c36665ae.js"></script><div class="code"><pre class="code literal-block">uvx<span class="w"> </span>autopep723<span class="w"> </span>https://gist.githubusercontent.com/mgaitan/7052bbe00c2cc88f8771b576c36665ae/raw/cbaa289ef7712b5f4c5a55316cce4269f5645c20/autopep723_rocks.py
</pre></div>

<p><img width="1122" height="722" alt="autopep8" src="https://gist.github.com/user-attachments/assets/b1413418-4ce7-4b04-9452-d69de3af3d82"></p>
<p><strong>Un tip extra?</strong> Usa <code>autopep723</code> directamente como el <em>shebang</em> de tu script</p>
<div class="code"><pre class="code literal-block"><span class="ch">#!/usr/bin/env -S uvx autopep723</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">httpx</span>
<span class="o">...</span>
</pre></div>

<p>Después de marcar el script como ejecutable (es decir, <code>chmod +x script.py</code>) simplemente podrás ejecutar <code>./script.py</code>. ¡Comparte este script con cualquiera y simplemente funcionará también en su máquina siempre que tenga <code>uv</code>!</p>
<h3>Cómo funciona</h3>
<p>Entre bastidores, <code>autopep723</code> analiza tu script usando el módulo <a href="https://docs.python.org/3/library/ast.html">ast</a> para detectar importaciones de terceros, maneja casos complicados conocidos donde los nombres de las importaciones difieren de los nombres de los paquetes (por ejemplo, <code>import PIL</code> → <code>pillow</code>), luego ejecuta tu script usando <code>uv run</code> pasando los <code>--with</code> necesarios automáticamente. Todo sucede en un entorno limpio y efímero gracias a las capacidades de aislamiento de <code>uvx</code>.</p>
<p>En mi humilde opinión, este enfoque resuelve varios puntos débiles que plagan la distribución de scripts de Python. Los scripts simplemente funcionan de inmediato con cero fricción de configuración, mientras que <code>uvx</code> garantiza que no haya contaminación del entorno, ya que las dependencias se instalan de forma aislada. Cada script obtiene su propio entorno limpio, lo que evita conflictos de versiones, lo que hace que los scripts sean verdaderamente portátiles sin instrucciones de instalación. La velocidad de <code>uv</code> hace que esto sea práctico para el uso diario en lugar de solo una demostración inteligente.</p>
<p>Por cierto, también podés usar <code>autopep723</code> para agregar metadatos PEP 723 a tus scripts existentes:</p>
<div class="code"><pre class="code literal-block">autopep723<span class="w"> </span>add<span class="w"> </span>script.py<span class="w">  </span><span class="c1"># Agrega PEP 723 al archivo</span>
</pre></div>

<p>y luego simplemente usa <code>uv run script.py</code></p>
<h3>El futuro</h3>
<p>Para ser honesto, me gustaría que este paquete no existiera, sino que fuera una característica incorporada de uv.</p>
<p>Tuiteé sobre esta idea pidiendo un flag <code>--with-auto</code> que haga su mejor intento para satisfacer las dependencias faltantes:</p>
<blockquote class="twitter-tweet">
<p lang="en" dir="ltr">how about a --with-auto that does its best attempt to satisfy missing deps? <a href="https://t.co/yYvYXGKZnM">https://t.co/yYvYXGKZnM</a></p>— Martín Gaitán (@tin_nqn_) <a href="https://twitter.com/tin_nqn_/status/1825970796478738940?ref_src=twsrc%5Etfw">August 21, 2024</a>
</blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script><p>Aquí está mi <a href="https://github.com/astral-sh/uv/issues/6283">propuesta abierta</a>. Hasta entonces, <code>autopep723</code> cierra la brecha, haciendo que los scripts de Python sean tan fáciles de ejecutar como los scripts de shell.</p>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/automation/" rel="tag">automation</a></li>
            <li><a class="tag p-category" href="../../categories/dependencies/" rel="tag">dependencies</a></li>
            <li><a class="tag p-category" href="../../categories/pep723/" rel="tag">pep723</a></li>
            <li><a class="tag p-category" href="../../categories/python/" rel="tag">python</a></li>
            <li><a class="tag p-category" href="../../categories/uv/" rel="tag">uv</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../svg-animados-para-tus-demos-de-programas-cli/" rel="prev" title="SVG animados para tus demos de programas CLI">Post anterior</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comentarios</h2>
                    <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="nqnwebs",
            disqus_url="https://mgaitan.github.io/posts/dependencias-automaticas-scripts-python-autopep723/",
        disqus_title="Depedencias autom\u00e1ticas en scripts Python con autopep723",
        disqus_identifier="cache/posts/autopep723-shebang-magic.html",
        disqus_config = function () {
            this.language = "es_ES";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section></article><script>var disqus_shortname="nqnwebs";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script><!--End of body content--><footer id="footer">
            Contents © 2025         <a href="mailto:gaitan@gmail.com">Martín Gaitán</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            
        </footer>
</div>
</div>

        <script src="https://code.jquery.com/jquery-3.6.4.min.js" integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js" integrity="sha384-+sLIOodYLS7CIrQpBjl+C7nPvqq+FbNUBDunl/OZv93DB7Ln/533i8e/mZXLi/P+" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/baguettebox.js/1.11.1/baguetteBox.min.js" integrity="sha256-ULQV01VS9LCI2ePpLsmka+W0mawFpEA0rtxnezUj4A4=" crossorigin="anonymous"></script><script src="../../assets/js/all.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="../../assets/js/jquery.timeago.js" type="text/javascript"></script><script>
    jQuery(document).ready(function() {

        if(jQuery('html').attr('lang') === 'es'){
             jQuery.timeago.settings.strings = {
               prefixAgo: "hace",
               prefixFromNow: "dentro de",
               suffixAgo: "",
               suffixFromNow: "",
               seconds: "menos de un minuto",
               minute: "un minuto",
               minutes: "unos %d minutos",
               hour: "una hora",
               hours: "%d horas",
               day: "un día",
               days: "%d días",
               month: "un mes",
               months: "%d meses",
               year: "un año",
               years: "%d años"
            };
        }
        jQuery("time.published").timeago();

        jQuery('article:not(:first)').before('<hr>');

        jQuery('.highlight pre').addClass('code');
    });
    </script><script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-51074482-1', 'mgaitan.github.io');
      ga('send', 'pageview');

    </script>
</body>
</html>
